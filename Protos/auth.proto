syntax = "proto3";

package auth;

import "Protos/role.proto";

option csharp_namespace = "PingChatApp.Common.Protos";
option go_package = "github.com/PingChatApp/Common/out/pb";


service AuthDataService {
    // client credentials flow
    rpc ResolveClientAuthorization(ResolveClientAuthRequest) returns (ResolvedClientAuthorization);

    // password flow
    rpc ValidateUserCredentials(ValidateUserRequest) returns (ValidateUserResponse);
    
    // Auth Code flow
    rpc ValidateAuthorizationCode(ValidateAuthCodeRequest) returns (ValidateAuthCodeResponse);

    // Token validation
    rpc ValidateAccessToken(ValidateAccessTokenRequest) returns (ValidateAccessTokenResponse);
}

message ResolveClientAuthRequest { string client_id = 1; }
message ValidateUserRequest { string username = 1; string password = 2; }
message ValidateAuthCodeRequest { string authorization_code = 1; string client_id = 2; string redirect_uri = 3; }
message ValidateAccessTokenRequest { string access_token = 1; }

message ResolvedClientAuthorization {
  string client_id = 1;
  repeated ScopeResponse scopes = 2;
}

message ValidateUserResponse {
  bool success = 1;
  int32 user_id = 2;
  repeated role.RoleResponse roles = 3;
  string error = 4;
}

message ValidateAuthCodeResponse 
{
  bool is_valid = 1; 
  string user_id = 2; 
  repeated ScopeResponse scopes = 3;
}

message ValidateAccessTokenResponse {
  bool is_active = 1;
  string subject = 2;
  repeated ScopeResponse scopes = 3;
  int64 expires_at = 4;
}

message ScopeResponse {
  string name = 1;
  string resource = 2;
}
